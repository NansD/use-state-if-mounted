<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Hook - useStateIfMounted</title><meta property="og:title" content="My new title"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/kZGawXPz4M7fsaH_w9E8C/pages/index.js" as="script"/><link rel="preload" href="/_next/static/kZGawXPz4M7fsaH_w9E8C/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d5efbf0a8a20bb777e8e.js" as="script"/><link rel="preload" href="/_next/static/chunks/4d47637119fc466886a74513d3aeb62698b19896.f996138c8a92a6f1bcc0.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-b1b3bf6813b73dc63172.js" as="script"/><style id="__jsx-2272958534">body{font-family:sans-serif;padding:0;margin:0;}main{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:1em 0;}h1{font-size:2em;}img{max-width:100%;}pre{overflow:auto;max-height:15em;background-color:#eeeeee;padding:1em;}section,footer{width:100%;max-width:50em;margin:0 auto;}footer p{font-size:0.9em;}footer p,footer a{color:#546e7a;}</style></head><body><div id="__next"><main class="jsx-2272958534"><section class="jsx-2272958534"><h1 class="jsx-2272958534">useStateIfMounted</h1><p class="jsx-2272958534">A hook for updating state only if the component is mounted.</p><p class="jsx-2272958534"><a href="https://github.com/NansD/use-state-if-mounted" class="jsx-2272958534">github.com/NansD/use-state-if-mounted</a></p><h2 class="jsx-2272958534">How to use</h2><p class="jsx-2272958534">Use this hook just like React&#x27;sÂ <a href="https://reactjs.org/docs/hooks-reference.html#usestate" class="jsx-2272958534">useState</a>.</p><p class="jsx-2272958534">This one hook only updates state if the component that called this hook is mounted. This allows us to avoid memory leaks and messages like this one :</p><code class="jsx-2272958534">Warning: Can&#x27;t perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in a useEffect cleanup function. in Child (created by Holder)</code><h2 class="jsx-2272958534">Examples</h2><p class="jsx-2272958534"><strong class="jsx-2272958534">Basic usage:</strong></p><pre class="jsx-2272958534"><code class="jsx-2272958534">
const [count, setCount] = useStateIfMounted(0);</code></pre><p class="jsx-2272958534"><strong class="jsx-2272958534">&quot;Real use case&quot; usage:</strong></p><p class="jsx-2272958534">It&#x27;s actually an <a href="https://github.com/facebook/react/issues/14113" class="jsx-2272958534">issue</a> from Github.</p><pre class="jsx-2272958534"><code class="jsx-2272958534">
const apiCall = n =&gt;
new Promise(resolve =&gt; setTimeout(() =&gt; resolve(n + 1), 3000));

const ShowApiCallResult = () =&gt; {
const [n, setN] = useState(0);
useEffect(() =&gt; {
  apiCall(n).then(newN =&gt; setN(newN));
});

return String(n);
};

const RemoveComponentWithPendingApiCall = () =&gt; {
const [show, setShow] = useState(true);
return (
  &lt;React.Fragment&gt;
    &lt;button onClick={() =&gt; setShow(false)}&gt;Click me&lt;/button&gt;
    {show &amp;&amp; &lt;ShowApiCallResult /&gt;}
  &lt;/React.Fragment&gt;
);
};
</code></pre><p class="jsx-2272958534">The issue can be fixed with our hook by simply replacing <code class="jsx-2272958534">useState</code> with <code class="jsx-2272958534">useStateIfMounted</code></p><pre class="jsx-2272958534"><code class="jsx-2272958534">
const apiCall = n =&gt;
new Promise(resolve =&gt; setTimeout(() =&gt; resolve(n + 1), 3000));

const ShowApiCallResult = () =&gt; {
const [n, setN] = useState(0);
useEffect(() =&gt; {
  apiCall(n).then(newN =&gt; setN(newN));
});

return String(n);
};

const RemoveComponentWithPendingApiCall = () =&gt; {
const [show, setShow] = useStateIfMounted(true); // notice the change ðŸš€
return (
  &lt;React.Fragment&gt;
    &lt;button onClick={() =&gt; setShow(false)}&gt;Click me&lt;/button&gt;
    {show &amp;&amp; &lt;ShowApiCallResult /&gt;}
  &lt;/React.Fragment&gt;
);
};</code></pre></section><footer class="jsx-2272958534"><p class="jsx-2272958534">Made by <a href="https://github.com/NansD/" class="jsx-2272958534">Nans Dumortier</a></p></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/","query":{},"buildId":"kZGawXPz4M7fsaH_w9E8C","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-0e1950c8b6ff6c7651db.js"></script><script async="" data-next-page="/" src="/_next/static/kZGawXPz4M7fsaH_w9E8C/pages/index.js"></script><script async="" data-next-page="/_app" src="/_next/static/kZGawXPz4M7fsaH_w9E8C/pages/_app.js"></script><script src="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" async=""></script><script src="/_next/static/chunks/framework.d5efbf0a8a20bb777e8e.js" async=""></script><script src="/_next/static/chunks/4d47637119fc466886a74513d3aeb62698b19896.f996138c8a92a6f1bcc0.js" async=""></script><script src="/_next/static/runtime/main-b1b3bf6813b73dc63172.js" async=""></script><script src="/_next/static/kZGawXPz4M7fsaH_w9E8C/_buildManifest.js" async=""></script><script src="/_next/static/kZGawXPz4M7fsaH_w9E8C/_ssgManifest.js" async=""></script></body></html>